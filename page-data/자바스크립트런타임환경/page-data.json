{"componentChunkName":"component---src-templates-post-template-tsx","path":"/자바스크립트런타임환경/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h1>자바스크립트 런타임 환경 - 브라우저</h1>\n<p>자바스크립트 자체에는 멀티 쓰레딩을 할 수 있는 방법이 없지만 자바스크립트가 동작하고 있는 브라우저 프로그램 안에는 여러 가지의 쓰레드가 들어 있다.<br>\n→ WEB APIs를 이용하면 멀티 쓰레딩이 가능하다.</p>\n<p>또한 자바스크립트 실행 환경 위에서는 이벤트 루프를 이용하여 멀티 쓰레딩 같은 효과를 줄 수 있다.</p>\n<h2>자바스크립트 런타임 환경에서의 자바스크립트 엔진</h2>\n<ul>\n<li>크게 메모리 힙과 콜스택으로 나눠져 있다.</li>\n<li>메모리 힙은 구조적으로 정리되지 않고, 여기저기 아무곳에서나 저장되어져 있다.</li>\n<li>콜스택에서 WEB API인 setTimeout을 호출하면 setTimeout은 콜스택에서 지워지고, WEB API는 타이머를 시작한다.</li>\n<li>타이머가 실행되고 있는 동안에도 자바스크립트 엔진은 병렬적으로 실행되고 있다가 타이머의 지정된 시간이 끝나면 WEB API는 setTimeout 호출 시 등록했던 콜백 함수를 태스크 큐에 집어 넣어준다.</li>\n<li>이벤트 루프는 루프를 돌면서 콜스택과 태스크 큐를 지속적으로 관찰하고 있다. 콜스택에 작업이 남아 있으면 콜스택이 비워질 때까지 기다린다. 콜스택이 비워져 자바스크립트 엔진이 더 이상 일을 하고 있지 않을 때 태스크 큐에 있는 작업을 한번에 하나씩 콜스택으로 데려다 자바스크립트 엔진이 작업을 수행할 수 있도록 도와준다.</li>\n<li>태스크 큐 이외에도 마이크로 태스크 큐와 렌더 시퀀스가 있다.</li>\n<li>프로미스가 수행이 되고난 뒤 실행되는 then에 등록한 콜백 함수, mutation observer라는 WEB API에 등록된 콜백 함수가 마이크로 태스크 큐에 들어온다.</li>\n<li>렌더 시퀀스는 주기적으로 화면에 업데이트해줄 때 필요하다. requestAnimationFrame이라는 WEB API로 콜백을 등록해 놓으면 다음 브라우저가 업데이트 되기 전까지 requestAnimationFrame에 들어 있는 큐에 콜백이 차곡차곡 쌓인다.</li>\n<li>콜스택에 작업 내용이 있는 동안에는 이벤트 루프는 콜스택에 계속 머물러 있다가 콜스택이 비워지면 드디어 루프를 돌게 되는데 렌더 시퀀스 쪽으로는 갈수도 있고 안 갈수도 있다. (브라우저에서는 우리가 업데이트 하는 내용을 사용자에게 60fps(16.7ms)로 보여주도록 노력하므로 이 범위 안에서 렌더를 업데이트 해준다)</li>\n<li>이벤트 루프가 마이크로 태스크 큐에 위치하게 되면 큐가 텅텅 빌 때까지 계속 콜스택으로 가지고 와서 수행한다. 여기에 머무르는 동안 또 다른 콜백이 들어온다면 나중에 들어온 아이도 전부 끝날 때까지 수행한다.</li>\n<li>마이크로 태스크 큐가 텅텅 비게 되면 이벤트 루프는 순회를 재개하고, 태스크 큐로 넘어온다. 태스크 큐에서는 하나의 콜백만 콜스택으로 데려와 콜스택에 머무르며 작업이 끝날 때까지 기다리고, 작업이 끝나면 다시 순회를 재개한다.</li>\n<li>화면에 업데이트할 시간이 되면 렌더 시퀀스에 들어와 먼저 requestAnimationFrame에 등록된 콜백 함수들을 하나 하나씩 다 실행한 다음 Render Tree를 생성하고, 트리를 이용하여 Layout을 계산한 다음, Paint를 통해 브라우저를 업데이트한다.</li>\n</ul>\n<p><img src=\"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/78941d47-3c88-46f5-b960-e8a4eb143b69/js-runtime-env.png\" alt=\"https://s3-us-west-2.amazonaws.com/secure.notion-static.com/78941d47-3c88-46f5-b960-e8a4eb143b69/js-runtime-env.png\">\n[출처: 드림코딩 엘리 - 브라우저 강의]</p>\n<h3>코드 반박하기</h3>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">button<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> element <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'h1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// element.style.color = 'red';</span>\n  <span class=\"token comment\">// element.innerText = 'hello';</span>\n  document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  element<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>color <span class=\"token operator\">=</span> <span class=\"token string\">'red'</span><span class=\"token punctuation\">;</span>\n  element<span class=\"token punctuation\">.</span>innerText <span class=\"token operator\">=</span> <span class=\"token string\">'hello'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>요소에 스타일과 텍스트를 적용한 뒤 append 해주지 않고, 요소를 먼저 append 해준 뒤 스타일과 텍스트를 적용해도 상관이 없는 이유는?\n: 버튼 클릭이 발생하면 해당 콜백 함수는 태스크 큐에 들어오고, 태스크 큐에서 콜스택으로 작업이 옮겨지고, 요소를 append 하고, 스타일과 텍스트를 적용하는 작업이 모두 완료가 된 다음 렌더 시퀀스로 이동하여 렌더링 작업을 수행하기 때문이다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">button<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'click'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>transition <span class=\"token operator\">=</span> <span class=\"token string\">'transform 1s ease-in'</span><span class=\"token punctuation\">;</span>\n  box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>transform <span class=\"token operator\">=</span> <span class=\"token string\">'translateX(800px)'</span><span class=\"token punctuation\">;</span>\n  box<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>transform <span class=\"token operator\">=</span> <span class=\"token string\">'translateX(500px)'</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>box가 800px만큼 갔다가 500px만큼 돌아오지 않는 이유는?\n: 버튼 클릭이 발생하면 해당 콜백 함수는 태스크 큐에 들어오고, 태스크 큐에서 콜스택으로 작업이 옮겨지고, 요소를 append 하고, 스타일과 텍스트를 적용하는 작업이 모두 완료가 된 다음 렌더 시퀀스로 이동하여 렌더링 작업을 수행하기 때문이다.</li>\n</ul>","frontmatter":{"title":"자바스크립트 런타임 환경 - 브라우저","summary":"자바스크립트 런타임 환경 - 브라우저","date":"2021.08.19.","categories":["자바스크립트"],"thumbnail":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWElEQVQ4y93TvUvDQBQA8P5ljtbar6SJqIUOgiCIOLqpgyC4ibuLIDq4iIODqKS5tPWjFbFa7CAGPwtStKW0effx5IJgNCkVx8INd9z7ce/dvQuBlfr3CPUd1r4nOd2z7IlJEszYlzTjkB0Govh9ECYKnE7Q0qwro1CaoeUFOMkASfzyPpzTHWOQ2ZsI70CS7G4deUfQJnLKyosyBUvvibckzo+KzhuvHQJR6c0ynE3KcjyH+/GIY4SZvY20AZbKXw8QUTRuWXXNDVC7p00UMKPO0QC735A4pznZCL1e4rVjRGSPu5CNdEmbKJAfZw879Gpe1C9EywYrxZ/2WHUVCmnRsnm9CMZQINZkPYWM+KigYEibtLICZoy/7CNrI2uL9jO9nHPfL7hm15txej4FhbQbp4IRhvwYLU7LPvkp/Rfm7pGEpyV0OZcvrP6tSWSQ1qVV+/xL9safzVRUXe7ziz4AAAAASUVORK5CYII=","aspectRatio":1,"src":"/static/4d0c06a3414d67c35f899c258df6afc3/230ae/js-image.png","srcSet":"/static/4d0c06a3414d67c35f899c258df6afc3/a9f05/js-image.png 200w,\n/static/4d0c06a3414d67c35f899c258df6afc3/23840/js-image.png 400w,\n/static/4d0c06a3414d67c35f899c258df6afc3/230ae/js-image.png 710w","srcWebp":"/static/4d0c06a3414d67c35f899c258df6afc3/84cd9/js-image.webp","srcSetWebp":"/static/4d0c06a3414d67c35f899c258df6afc3/8444f/js-image.webp 200w,\n/static/4d0c06a3414d67c35f899c258df6afc3/42fc5/js-image.webp 400w,\n/static/4d0c06a3414d67c35f899c258df6afc3/84cd9/js-image.webp 710w","sizes":"(max-width: 710px) 100vw, 710px"}},"publicURL":"/static/4d0c06a3414d67c35f899c258df6afc3/js-image.png"}}}}]}},"pageContext":{"slug":"/자바스크립트런타임환경/"}},"staticQueryHashes":[]}