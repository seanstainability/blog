---
date: '2021-08-13'
title: '브라우저는 어떻게 동작하는가 - 1부'
categories: ['브라우저']
summary: '브라우저 동작 원리에 대한 흐름을 알아본다.'
thumbnail: 'resources/browser.png'
---

# 브라우저는 어떻게 동작하는가 - 1부

[브라우저 시장 점유율 살펴보기](https://gs.statcounter.com/)

## 하드웨어

위치 : 하드웨어 ← 운영체제 ← 애플리케이션

### CPU 코어

작업을 '순서대로' 처리한다.

### GPU

여러 GPU 코어가 '동시에' 작업을 처리한다.

### 하드웨어 가속

CPU 대신 GPU로 그래픽, 사운드 등의 특정 작업 수행 속도를 높이는 것

## 프로세스와 스레드

위치 : 운영체제 ← 애플리케이션 ← 프로세스 ← 스레드

운영체제에서 애플리케이션 실행 시 작업 공간인 메모리를 할당해준다.  
동일한 프로세스는 메모리를 공유할 수 있지만 서로 다른 프로세스는 메모리를 공유할 수 없다.

### 프로세스

애플리케이션이 실행하는 프로그램

- 다른 프로세스의 실행을 운영체제에 요청할 수 있다.
- 프로세스 간 통신이 가능하다.(IPC 통신)

### 스레드

프로세스로 실행되는 프로그램의 일부를 실행한다.

## 크롬 브라우저

브라우저 프로세스, 렌더러 프로세스, GPU 프로세스, 플러그인 프로세스...
→ 도구 더보기 - 작업 관리자에서 확인 가능

### 다중 프로세스 아키텍처

- 브라우저 프로세스는 탭 영역 밖에 있는 모든 부분을 제어한다.
- 탭마다 렌더러 프로세스를 할당한다.(정확히는 iframe에 있는 인라인 사이트를 포함한 사이트별로 렌더러 프로세스를 할당한다.)  
  → process per site

### 서비스화

성능 좋은 하드웨어와 리소스(메모리)가 제한적인 장치를 구분하여 각 서비스를 여러 프로세스로 분리하거나 하나의 프로세스에서 실행하거나 한다.

## 동일 출처 정책(same-origin policy)

URL의 프로토콜, 호스트(도메인), 포트가 모두 일치하는 경우 동일 출처라고 한다.

동일 출처가 아닌 경우 브라우저가 HTTP 요청을 제한한다.

### CORS

**교차 출처 리소스 공유**

- 추가 HTTP 헤더를 사용하여, 한 출처에서 실행 중인 웹 애플리케이션이 다른 출처의 자원에 접근할 수 있는 권한을 부여하도록 브라우저에 알려주는 것이다.
- 어떤 호스트에서 자신의 콘텐츠를 불러갈 수 있는지 서버에서 지정할 수 있다.

## 네비게이션 과정

사용자가 주소창에 URL을 입력하여 사이트를 요청하고, 브라우저가 인터넷에서 데이터를 가져와 페이지 렌더링을 준비하는 과정

### 브라우저 프로세스

- UI 스레드 : 브라우저의 버튼과 입력란을 그린다.
- 네트워크 스레드
- 스토리지 스레드 : 파일에 대한 접근을 제어한다.

### 요청

- URL 입력을 가지고 UI 스레드가 네트워크 스레드에 요청한다.
- 네트워크 스레드가 DNS Lookup, 프로토콜 연결 설정 등을 통해 요청을 처리한다.

### 응답

- 네트워크 스레드는 응답 페이로드가 들어오면 MIME 스니핑을 한다.
- 렌더러 프로세스가 다룰 수 있는 데이터 형식인지 판단하여 렌더러 프로세스에 전달하거나, 다운로드 요청으로 판단하여 다운로드 매니저로 전달하기도 한다.
- Safe Browsing 검사를 실행하여, 악성 사이트로 알려진 사이트와 일치할 경우 경고 페이지로 표시하라고 알린다.

#### MIME 스니핑

- Content-Type 헤더에 설정된 데이터 형식과 실제 데이터 형식을 비교하여 다른 경우 실제 데이터 형식을 기준으로 실행한다.
- XSS(크로스 사이트 스크립팅) 공격의 여지가 있어, `X-Content-Type-Options: nosniff` 헤더를 추가하여 Content-Type 헤더에 설정된 데이터 형식으로만 리소스를 처리하도록 하기도 한다.

#### CORB

서로 다른 사이트(cross-site)의 민감한 데이터가 렌더러 프로세스에서 실행되지 않게 검사한다.

### 렌더러 프로세스

- 네트워크 스레드는 UI 스레드에 데이터가 준비되었음을 알린다.
- UI 스레드는 웹 페이지의 렌더링을 수행할 렌더러 프로세스를 찾는다.
- 브라우저 프로세스에서 렌더러 프로세스로 IPC 메시지를 전송한다.(데이터 스트림을 전달하여 데이터를 계속 수신할 수 있도록 한다.)
- 렌더러 프로세스는 계속 리소스를 로딩하고, 페이지를 렌더링한다.
- 페이지의 생명 주기를 바탕으로 브라우저 프로세스와 렌더러 프로세스 간의 IPC 통신이 지속적으로 이루어진다.
  - 렌더러 프로세스가 렌더링을 끝내면 load 이벤트가 발생한 후 브라우저 프로세스로 페이지 로드가 완료되었다는 IPC 메시지를 보낸다.
  - 다른 사이트로 이동하기 전에 브라우저 프로세스는 렌더러 프로세스에게 beforeunload 이벤트를 처리해야 하는지 묻는다.

## 네비게이션 속도 향상

### 서비스워커

- 렌더러 프로세스에서 실행되는 자바스크립트 코드이다.
- 네비게이션 발생 시 네트워크 스레드는 도메인을 등록된 서비스 워커의 범위와 비교하여 해당 URL에 등록된 서비스 워커가 있으면 UI 스레드는 서비스 워커 코드를 실행하기 위해 렌더러 프로세스를 찾는다.

### 프리로드

서비스 워커가 네트워크에서 데이터를 요청하기로 하면 지연(Latency)이 발생하는데, 서비스 워커의 시작과 병렬로 리소스를 로딩하여 내비게이션 과정의 속도를 높이는 매커니즘이다.

## 참조

- [최신 브라우저의 내부 살펴보기 1 - CPU, GPU, 메모리 그리고 다중 프로세스 아키텍처](https://d2.naver.com/helloworld/2922312#ch8)
- [최신 브라우저의 내부 살펴보기 2 - 내비게이션 과정에서 일어나는 일](https://d2.naver.com/helloworld/9274593)
